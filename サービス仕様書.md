# Polaris LMS サービス仕様書

## 1. サービス概要

### 1.1 サービス名
**Polaris LMS**（ポラリス ラーニング マネジメント システム）

### 1.2 サービスビジョン
> 「一人ひとりの学びに、最適な道筋を。」

Polaris LMS は、**児童養護施設**で暮らす小学生から高校生までの子どもたちが、自分のペースで着実に学力を伸ばすための学習管理プラットフォームです。問題演習・スケジュール管理・学習分析を一元化し、子ども・施設職員（見守り者）・学習支援員・管理者それぞれに最適な体験を提供します。

### 1.3 解決する課題

| 課題 | Polaris LMS による解決 |
|------|----------------------|
| 子どもがどこでつまずいているか分からない | 正答率・理解度の自動分析で苦手分野を可視化 |
| 復習のタイミングが分からない | 理解度に基づく自動復習提案 |
| シフト交代時に学習状況の引き継ぎが困難 | 施設職員向けダッシュボードで担当児童の学習状況をいつでも確認 |
| 学習支援員（ボランティア等）ごとに指導がばらつく | データに基づいた客観的な学習状況の共有 |
| 問題の登録・管理が煩雑 | CSV一括インポートと科目・カテゴリ別の体系的管理 |
| 子どものモチベーション維持が難しい | 達成バッジ・連続学習記録によるゲーミフィケーション |
| 個別支援計画（IEP）と学習支援の連携が不十分 | IEP目標と学習記録の紐付けで支援の一貫性を確保 |

### 1.4 対象ユーザー

| ユーザー種別 | 略称 | 概要 | 主な利用シーン |
|------------|------|------|--------------|
| **生徒** | student | 施設で暮らす小学生〜高校生。問題を解き、学習を進める | 施設内での自習時間、学習支援の時間 |
| **施設職員（見守り者）** | guardian | 担当児童の学習状況を確認する施設職員。保護者に代わり子どもの学びを見守る | 担当児童の学習進捗確認、シフト引き継ぎ時の状況把握 |
| **学習支援員** | staff | 学習ボランティア・支援員。子どもの指導・問題管理を行う | 担当児童の進捗管理、スケジュール作成 |
| **管理者** | administrator | システム全体を管理する施設管理者・運営者 | ユーザー管理、問題登録、統計分析 |

### 1.5 対象学年と科目

| 対象 | 範囲 |
|------|------|
| 学年 | 小学1年生 〜 高校3年生（全12学年） |
| 科目 | 数学（算数）、国語、英語、理科、社会 など（科目は追加可能） |

---

## 2. ユーザー体験（UX）フロー

### 2.1 生徒の学習フロー

```
ログイン → ホーム画面（今日のスケジュール・お知らせ）
    │
    ├─→ スケジュールから「問題を解く」
    │       │
    │       ├─ 問題が表示される（解答開始時刻を自動記録）
    │       ├─ 解答を入力
    │       ├─ 答え合わせ（正誤判定）
    │       ├─ 理解度を自己評価（★1〜5）
    │       └─ 履歴に自動記録 → スケジュールを「完了」に更新
    │
    ├─→ 学習履歴を確認
    │       ├─ 正答率・理解度の推移グラフ
    │       ├─ 苦手分野の確認
    │       └─ 復習が必要な問題の一覧
    │
    ├─→ 達成バッジを確認
    │       └─ 連続学習日数・目標達成などのバッジ表示
    │
    ├─→ 学習目標を確認・設定
    │       └─ 週間・月間の学習目標と進捗
    │
    └─→ IEP目標の確認（対象児童のみ）
            └─ 個別支援計画に紐づく学習目標と進捗の確認
```

### 2.2 施設職員（見守り者）の利用フロー

```
ログイン → ホーム画面（担当児童の学習状況サマリー）
    │
    ├─→ 担当児童の学習レポート閲覧
    │       ├─ 週間・月間の学習時間
    │       ├─ 科目別の正答率
    │       └─ 苦手分野のハイライト
    │
    ├─→ IEP目標と学習進捗の照合
    │       └─ 個別支援計画の目標に対する学習達成状況を確認
    │
    └─→ お知らせの確認
```

### 2.3 学習支援員の業務フロー

```
ログイン → ホーム画面（担当児童一覧・今日のスケジュール）
    │
    ├─→ 担当児童の学習状況確認
    │       ├─ 児童ごとの正答率・理解度
    │       ├─ 未完了タスクの確認
    │       └─ 苦手分野の分析
    │
    ├─→ スケジュール管理
    │       ├─ 児童のスケジュール作成（単発・一括）
    │       ├─ 復習スケジュールの提案・承認
    │       └─ スケジュールの編集・削除
    │
    ├─→ 問題管理
    │       ├─ 問題の作成・編集
    │       ├─ CSVファイルでの一括インポート
    │       └─ 科目・カテゴリの管理
    │
    ├─→ お知らせ作成・配信
    │
    └─→ アンケート結果の確認
```

### 2.4 管理者の業務フロー

```
ログイン → ホーム画面（システム全体の統計ダッシュボード）
    │
    ├─→ ユーザー管理
    │       ├─ ユーザーの作成・編集・削除
    │       ├─ 施設職員-児童の関係設定
    │       └─ 学習支援員-児童の担当割り当て
    │
    ├─→ 問題管理（スタッフと同等 + 削除権限）
    │
    ├─→ 全生徒の学習統計閲覧
    │
    ├─→ アンケート質問の管理
    │
    └─→ お知らせ作成・配信
```

---

## 3. 機能一覧

### 3.1 アカウント管理機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| A-1 | ユーザー登録 | ユーザー種別に応じた登録フォーム。生徒の場合は学年の入力が必須 | 全ユーザー |
| A-2 | ログイン | ユーザー種別ごとの入口を用意し、種別に応じたホーム画面へ遷移 | 全ユーザー |
| A-3 | ログアウト | セッションを終了しウェルカムページへ戻る | 全ユーザー |
| A-4 | プロフィール編集 | 表示名（full_name）、学年等の変更 | 全ユーザー |
| A-5 | ユーザー管理 | 全ユーザーの一覧表示・作成・編集・削除 | 管理者 |
| A-6 | 施設職員-児童 関係登録 | 施設職員（見守り者）と児童の紐付け（担当開始日・有効フラグ付き） | 管理者 |
| A-7 | 学習支援員-児童 担当登録 | 学習支援員と担当児童の紐付け（担当開始日・有効フラグ付き） | 管理者 |

#### ユーザー情報の項目

| 項目 | 説明 | 必須 | 備考 |
|------|------|------|------|
| ユーザー名（user_name） | ログインに使用するID | ○ | 一意。50文字以内 |
| パスワード | ログイン用パスワード | ○ | ハッシュ化して保存 |
| ユーザー種別（user_type） | student / guardian / staff / administrator | ○ | 登録時に選択 |
| 表示名（full_name） | 画面に表示される名前 | ○ | 50文字以内 |
| 学年（grade） | 小1〜高3（1〜12） | △ | 生徒の場合のみ必須 |
| 有効フラグ（is_active） | アカウントの有効/無効 | ○ | デフォルトTrue |

### 3.2 問題管理機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| P-1 | 問題一覧表示 | 科目・カテゴリ・難易度・学年でフィルタリング可能。ページネーション付き | 生徒・スタッフ・管理者 |
| P-2 | 問題詳細表示 | 問題文と正解の表示 | 生徒・スタッフ・管理者 |
| P-3 | 問題作成 | 科目・カテゴリ・難易度を指定して問題を個別登録 | スタッフ・管理者 |
| P-4 | 問題編集 | 登録済み問題の修正 | スタッフ・管理者 |
| P-5 | 問題削除 | 論理削除（無効化） | 管理者 |
| P-6 | CSV一括インポート | CSVファイルから問題を一括登録 | スタッフ・管理者 |
| P-7 | 科目管理 | 科目の追加・編集・表示順変更 | 管理者 |
| P-8 | カテゴリ管理 | 問題カテゴリの追加・編集・表示順変更 | スタッフ・管理者 |

#### 問題の出題形式

| 形式 | 説明 | problem_type値 | Phase |
|------|------|----------------|-------|
| **記述式（テキスト解答）** | 生徒がテキストで解答を入力し、正解と照合する | `text` | Phase 1 |
| **選択式** | 複数の選択肢から正解を選ぶ形式。選択肢はChoiceテーブルで管理 | `choice` | Phase 1 |
| **画像対応（将来対応）** | 問題文に図や画像を含められる形式 | - | Phase 3 |

#### 選択式問題の仕組み

選択式問題では、Problemテーブルの `problem_type` を `choice` に設定し、選択肢を Choice テーブルで管理します。

- 各選択肢にはラベル（ア・イ・ウ・エ等）と本文を設定
- `is_correct` フラグで正解の選択肢を指定（複数可）
- `display_order` で選択肢の表示順を制御
- 記述式問題（`text`）の場合は従来通り Problem.answer で正誤判定

#### 問題データの構成

| 項目 | 説明 | 必須 |
|------|------|------|
| 出題形式 | text（記述式）/ choice（選択式） | ○ |
| 科目 | 数学・国語・英語・理科・社会 など | ○ |
| カテゴリ | 科目内の単元（例：分数の計算、一次方程式） | ○ |
| 問題文 | 問題の本文（500文字以内） | ○ |
| 正解 | 記述式の場合：正解テキスト（200文字以内）。選択式の場合：Choiceテーブルのis_correctで管理 | △ |
| 選択肢 | 選択式の場合のみ。ラベル・本文・正解フラグを持つ（Choiceテーブル） | △ |
| 難易度 | 1（易）〜 5（難）の5段階 | - |
| 対象学年 | カテゴリに紐づく対象学年 | ○ |

> △印：記述式の場合は正解が必須、選択式の場合は選択肢（Choice）が必須

#### CSV一括インポート仕様
既存のCSVフォーマット（`問題作成/問題/` 配下のファイル）を使用し、管理画面からアップロードすることで問題を一括登録できます。

| CSVカラム | 対応項目 | 備考 |
|-----------|----------|------|
| 科目名 | Subject.subject_name | |
| カテゴリ名 | ProblemCategory.title | |
| 学年 | ProblemCategory.grade | |
| 出題形式 | Problem.problem_type | text または choice |
| 問題文 | Problem.problem | |
| 正解 | Problem.answer | 記述式の場合のみ |
| 難易度 | Problem.difficulty | |
| 選択肢ア | Choice.choice_text | 選択式の場合のみ |
| 選択肢イ | Choice.choice_text | 選択式の場合のみ |
| 選択肢ウ | Choice.choice_text | 選択式の場合のみ |
| 選択肢エ | Choice.choice_text | 選択式の場合のみ |
| 正解の選択肢 | Choice.is_correct | 選択式の場合のみ。ア・イ・ウ・エで指定 |

### 3.3 スケジュール管理機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| S-1 | スケジュール作成 | 問題と予定日を指定してスケジュール登録 | 生徒（自分のみ）・スタッフ・管理者 |
| S-2 | 一括スケジュール作成 | 複数の問題をまとめてスケジュール登録 |  生徒（自分のみ）・スタッフ・管理者 |
| S-3 | カレンダー表示 | 月別・週別のカレンダーでスケジュールを視覚的に確認 | 生徒・スタッフ・管理者 |
| S-4 | 今日のスケジュール | 当日に予定されている問題の一覧 | 生徒・スタッフ・管理者 |
| S-5 | スケジュール編集 | 日付変更・メモ追加 | 生徒（自分のみ）・スタッフ・管理者 |
| S-6 | スケジュール削除 | 不要なスケジュールの削除 | 生徒（自分のみ）・スタッフ・管理者 |
| S-7 | ステータス管理 | 未着手 → 進行中 → 完了 のステータス遷移 | 自動（問題解答時）・手動 |
| S-8 | 問題を解く | スケジュールから直接問題画面へ遷移し、解答・記録まで一気通貫 | 生徒 |
| S-9 | 未完了アラート | 予定日を過ぎた未完了スケジュールをハイライト表示 | 生徒・学習支援員 |

#### ステータス遷移

```
┌─────────┐     問題を開く     ┌─────────┐     解答完了      ┌─────────┐
│  未着手   │ ─────────────→ │  進行中   │ ──────────────→ │   完了   │
└─────────┘                 └─────────┘                  └─────────┘
```

### 3.4 学習履歴・分析機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| H-1 | 履歴自動記録 | 問題を解いた際に開始時刻・終了時刻・所要時間・正誤・理解度を自動記録 | 自動 |
| H-2 | 履歴一覧 | 時系列・問題別・科目別・カテゴリ別で履歴を閲覧 | 生徒（自分）・施設職員（担当児童）・学習支援員（担当児童）・管理者（全員） |
| H-3 | 統計ダッシュボード | 正答率・学習時間・取り組み回数の集計 | 同上 |
| H-4 | グラフ表示 | 理解度推移・正答率推移・科目別学習時間の可視化 | 同上 |
| H-5 | 苦手分野分析 | 正答率が低いカテゴリ・科目の抽出と表示 | 同上 |
| H-6 | 復習推奨 | 理解度が低い問題・不正解の問題を自動抽出し復習を提案 | 生徒・学習支援員 |
| H-7 | 学習時間分析 | 日別・週別・月別の学習時間集計 | 同上 |
| H-8 | 比較機能 | 同一問題の過去履歴比較（同一児童の成長推移を確認） | 学習支援員・管理者 |

#### 履歴データの項目

| 項目 | 説明 | 記録方法 |
|------|------|----------|
| 問題 | 解いた問題への参照 | 自動 |
| 生徒 | 解答した生徒 | 自動 |
| 理解度（level） | 自己評価 1（全く分からない）〜 5（完全に理解） | 手動入力 |
| 解答開始時刻 | 問題を表示した時刻 | 自動 |
| 解答終了時刻 | 解答を送信した時刻 | 自動 |
| 所要時間（秒） | 終了 − 開始 | 自動計算 |
| 正誤 | 正解かどうか | 自動判定 |

#### 復習提案のロジック
以下のいずれかの条件を満たす問題が復習対象として自動抽出されます：

1. **理解度が低い**: level が 1〜2（5段階中）
2. **不正解**: 直近の解答で間違えた問題
3. **時間経過**: 最後に解いてから3日以上経過

→ 条件に該当する問題リストを表示し、生徒または学習支援員が承認するとスケジュールに自動登録されます。

### 3.5 お知らせ機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| N-1 | お知らせ一覧 | ユーザー種別・学年に応じたお知らせの表示（重要マーク付き） | 全ユーザー |
| N-2 | お知らせ詳細 | タイトル・本文・公開日の詳細表示 | 全ユーザー |
| N-3 | お知らせ作成 | タイトル・本文・対象者・重要フラグ・公開日時を指定して作成 | スタッフ・管理者 |
| N-4 | お知らせ編集 | 作成済みお知らせの修正 | スタッフ・管理者 |
| N-5 | お知らせ削除 | 不要なお知らせの削除 | スタッフ・管理者 |
| N-6 | 下書き保存 | 公開前のお知らせを下書きとして保存 | スタッフ・管理者 |

#### 配信対象の設定

| 対象タイプ | 説明 |
|-----------|------|
| 全員（all） | 全ユーザーに配信 |
| 学年別（grade） | 特定の学年の生徒に配信 |
| ユーザー種別（user_type） | 特定のユーザー種別（生徒のみ、施設職員のみ等）に配信 |

### 3.6 アンケート機能

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| Q-1 | アンケート回答 | リッカート尺度（1〜5）での質問回答 | 生徒 |
| Q-2 | 質問管理 | アンケート質問の追加・編集・削除 | 管理者 |
| Q-3 | 集計・分析 | 質問別の集計結果、平均値・分布・時系列変化の表示 | スタッフ・管理者 |

### 3.7 達成バッジ・ゲーミフィケーション機能 【新規】

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| G-1 | 達成バッジ表示 | 獲得したバッジの一覧表示 | 生徒 |
| G-2 | バッジ獲得通知 | 新しいバッジを獲得した際の通知 | 生徒 |
| G-3 | 連続学習記録 | 連続で学習した日数のカウントと表示 | 生徒 |

#### バッジの種類（例）

| バッジ名 | 獲得条件 |
|---------|---------|
| はじめの一歩 | 初めて問題を解いた |
| 3日連続 | 3日連続で学習した |
| 7日連続 | 7日連続で学習した |
| 30日連続 | 30日連続で学習した |
| 100問達成 | 累計100問解いた |
| 科目マスター | 特定科目の正答率が90%以上 |
| 復習の達人 | 復習提案を10回以上クリアした |
| 目標達成 | 週間・月間の学習目標を達成した |

### 3.8 学習目標機能 【新規】

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| T-1 | 週間目標設定 | 週あたりの学習問題数・学習時間の目標を設定 | 生徒・学習支援員 |
| T-2 | 月間目標設定 | 月あたりの学習目標を設定 | 生徒・学習支援員 |
| T-3 | 目標進捗表示 | 設定した目標に対する現在の進捗をプログレスバーで表示 | 生徒・学習支援員 |
| T-4 | 目標達成通知 | 目標達成時に通知・バッジ付与 | 生徒 |

### 3.9 施設職員向け学習レポート 【新規】

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| R-1 | 週間レポート生成 | 担当児童の1週間の学習サマリーを自動生成 | 自動 |
| R-2 | レポート閲覧 | 過去のレポートをブラウザ上で閲覧（シフト引き継ぎ時の確認に活用） | 施設職員（見守り者） |
| R-3 | IEP進捗レポート | IEP目標に対する学習達成状況のレポート | 施設職員・学習支援員・管理者 |

#### レポートに含まれる情報

- 学習日数・合計学習時間
- 解いた問題数・正答率
- 科目別の取り組み状況
- 理解度の変化（先週との比較）
- 苦手分野のハイライト
- 学習支援員からの一言コメント（任意）
- IEP目標に対する進捗（対象児童のみ）

### 3.10 個別支援計画（IEP）連動機能 【新規】

| # | 機能名 | 概要 | 利用者 |
|---|--------|------|--------|
| I-1 | IEP目標登録 | 児童ごとに個別支援計画の学習関連目標を登録（例：「九九を覚える」「漢字100字習得」） | 学習支援員・管理者 |
| I-2 | IEP目標と問題カテゴリの紐付け | IEP目標に対応する問題カテゴリを関連付け、進捗を自動計測 | 学習支援員・管理者 |
| I-3 | IEP進捗表示 | IEP目標ごとの達成状況をプログレスバーで表示 | 生徒・施設職員・学習支援員・管理者 |
| I-4 | IEP進捗レポート出力 | IEP目標に対する学習実績のレポートをブラウザ上で閲覧 | 施設職員・学習支援員・管理者 |

#### IEP目標データの構成

| 項目 | 説明 | 必須 |
|------|------|------|
| 対象児童 | IEP目標の対象となる生徒 | ○ |
| 目標タイトル | 目標の概要（例：「かけ算の九九を全て覚える」） | ○ |
| 目標詳細 | 具体的な達成基準の説明 | - |
| 関連カテゴリ | この目標に紐づく問題カテゴリ（複数設定可） | - |
| 目標期限 | 達成目標日 | - |
| ステータス | 未着手・進行中・達成 | ○ |

---

## 4. ユーザー権限マトリクス

| 機能 | 生徒 | 施設職員（見守り） | 学習支援員 | 管理者 |
|------|:----:|:------:|:--------:|:------:|
| 問題を閲覧 | ○ | - | ○ | ○ |
| 問題を作成・編集 | - | - | ○ | ○ |
| 問題を削除 | - | - | - | ○ |
| 問題をCSVインポート | - | - | ○ | ○ |
| スケジュール作成（自分） | ○ | - | ○ | ○ |
| スケジュール作成（他の児童） | - | - | ○ | ○ |
| 学習履歴の閲覧（自分） | ○ | ○ | ○ | ○ |
| 学習履歴の閲覧（他の児童） | - | ○※ | ○※ | ○ |
| 統計・分析の閲覧（自分） | ○ | ○ | ○ | ○ |
| 統計・分析の閲覧（他の児童） | - | ○※ | ○※ | ○ |
| お知らせの閲覧 | ○ | ○ | ○ | ○ |
| お知らせの作成 | - | - | ○ | ○ |
| アンケートの回答 | ○ | - | - | - |
| アンケート結果の閲覧 | - | - | ○ | ○ |
| ユーザー管理 | - | - | - | ○ |
| 学習目標の設定 | ○ | - | ○ | ○ |
| 学習レポートの閲覧 | - | ○ | ○ | ○ |
| バッジの閲覧 | ○ | - | ○ | ○ |
| IEP目標の登録・編集 | - | - | ○ | ○ |
| IEP進捗の閲覧 | ○ | ○ | ○ | ○ |

> ※印：施設職員は**自分が担当する児童のみ**、学習支援員は**自分が担当する児童のみ**閲覧可能

---

## 5. 業務ワークフロー

### 5.1 中心となるデータの流れ

```
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│   問題管理     │      │  スケジュール   │      │   学習履歴     │
│  (Problems)   │─────→│  (Schedules)  │─────→│  (Histories)  │
│              │      │              │      │              │
│ 問題データの   │      │「いつ」「誰が」 │      │ 解答結果の     │
│ 提供元        │      │「どの問題を」   │      │ 記録・分析     │
└──────────────┘      └──────────────┘      └──────────────┘
                              ↑                      │
                              └──── 復習提案 ─────────┘
```

- **問題管理**: 科目・カテゴリ別に体系化された問題データベース
- **スケジュール**: 問題と履歴をつなぐ中心的な役割。「予定」を管理
- **学習履歴**: 実績データを蓄積し、分析・復習提案にフィードバック

### 5.2 問題を解くまでの流れ

```
Step 1: スケジュール作成
   生徒またはスタッフが、問題を選択し予定日を設定
   → ステータスは「未着手」
   
Step 2: スケジュール確認
   カレンダーや一覧画面で当日のスケジュールを確認
   
Step 3: 問題を解く
   「問題を解く」ボタンを押す → 問題画面が表示される
   ※この時点で解答開始時刻が自動記録される
   
Step 4: 解答を入力
   記述式：生徒が解答をテキスト入力する
   選択式：表示された選択肢から正解を選択する
   
Step 5: 答え合わせ
   送信すると正解と照合し、正誤が自動判定される
   ※解答終了時刻が自動記録される
   
Step 6: 理解度の自己評価
   生徒が理解度を★1〜5で評価する
   
Step 7: 記録と更新
   ・学習履歴に全データが自動保存される
   ・スケジュールのステータスが「完了」に更新される
   ・達成条件を満たしていればバッジが付与される
```

### 5.3 復習サイクル

```
Step 1: 復習対象の自動抽出
   履歴から理解度が低い問題・不正解の問題・時間が経った問題を自動抽出
   
Step 2: 復習の提案
   抽出された問題のリストと推奨日程を表示
   
Step 3: スケジュール登録
   生徒またはスタッフが承認すると、復習スケジュールが自動作成される
   
Step 4: 再学習
   通常の「問題を解く」フローで再度取り組む
   
Step 5: 成長の確認
   過去の履歴と比較し、理解度の向上を確認
```

---

## 6. 画面設計

### 6.1 共通レイアウト

#### 全体構成（3カラムレイアウト）

現在の実装では、ログイン後の画面は**左サイドバー＋メインコンテンツ＋右サイドバー**の3カラム構成を採用しています。

```
┌──────┬──────────────────────────────┬────────────┐
│      │                              │            │
│ サイド │      メインコンテンツ          │ 今日やること │
│ バー   │      エリア                  │ サイドバー  │
│      │                              │            │
│ ロゴ   │  ヘッダー（挨拶・統計）        │ タスク数表示│
│      │                              │            │
│チェック│  カレンダー / 問題一覧 /       │ タスクカード│
│イン    │  履歴 etc.                   │ リスト      │
│      │                              │            │
│ ホーム │                              │            │
│学習記録│                              │            │
│問題一覧│                              │            │
│ 成績  │                              │            │
│アンケート│                              │            │
│お知らせ│                              │            │
│ログアウト│                              │            │
│      │                              │            │
└──────┴──────────────────────────────┴────────────┘
```

#### 左サイドバー（ナビゲーション）

| 要素 | 説明 |
|------|------|
| ロゴ | 「学びのポラリス」ロゴ画像を表示 |
| チェックインボタン | 緑色のボタン。出席記録用 |
| ナビゲーションメニュー | 以下のリンクを縦に配置。アクティブなページは白背景＋左に青いアクセント線で強調 |

**ナビゲーション項目（現在の実装）：**

| 順番 | メニュー名 | アイコン | 遷移先 |
|:----:|-----------|---------|--------|
| 1 | ホーム | 家アイコン | 各ユーザー種別のホーム画面 |
| 2 | 学習記録 | ドキュメントアイコン | 学習履歴一覧 |
| 3 | 問題一覧 | ファイルアイコン | 問題一覧画面 |
| 4 | 成績 | 人物アイコン | 成績・統計画面 |
| 5 | アンケート | フォームアイコン | アンケート画面 |
| 6 | お知らせ | ベルアイコン | お知らせ一覧 |
| 7 | ログアウト | 退出アイコン | ログアウト確認モーダルを表示 |

#### 右サイドバー（今日やることリスト）

| 要素 | 説明 |
|------|------|
| タスク数バッジ | 当日のタスク数を数字で表示 |
| タスクカードリスト | タスクごとにカード形式で表示（タイトル・日付・科目・学年・完了チェックボタン） |

#### ページヘッダー（メインコンテンツ上部）

```
┌──────────────────────────────────────────────────────┐
│ ○○さん、こんにちは！     総ログイン日数  連続ログイン日数  問題回答数 │
│                           (10)          (10)          (10)     │
│                          紺色の丸     紺色の丸      紺色の丸    │
└──────────────────────────────────────────────────────┘
```

- 左側：ユーザー名を含む挨拶メッセージ（太字35px）
- 右側：統計バッジ3つ（紺色の丸の中に数値を表示）

#### ログアウト確認モーダル

ログアウトリンクをクリックすると、画面中央にモーダルダイアログが表示されます。

| 要素 | 説明 |
|------|------|
| 背景オーバーレイ | 半透明の黒背景（画面全体を覆う） |
| モーダル本体 | 白背景・角丸12px・影付き。「本当にログアウトしますか？」メッセージ |
| キャンセルボタン | グレー背景。モーダルを閉じる |
| ログアウトボタン | 赤色背景。POSTリクエストでログアウト実行 |

#### ウェルカムページ（ログイン前）

ログイン前の入口画面は共通レイアウト（サイドバー）を使用せず、独立した1カラムの画面です。

```
┌──────────────────────────────┐
│                              │
│  学びのポラリスへようこそ！     │
│                              │
│  該当ページを選択してください    │
│                              │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐│
│  │生徒│ │職員 │ │支援員│ │管理者││
│  └────┘ └────┘ └────┘ └────┘│
│                              │
│     新規登録はこちら           │
│                              │
└──────────────────────────────┘
```

- 4つのロールボタン（丸形）を横並びに表示
- 各ボタンをクリックすると、対応するロールのログイン画面へ遷移
- 下部に新規登録リンク

#### レスポンシブ対応

| ブレークポイント | 対応内容 |
|:---------------:|---------|
| 1200px以下（タブレット） | サイドバー幅を200pxに縮小、フォントサイズを調整 |
| 768px以下（スマートフォン） | サイドバーを非表示にし、左上にハンバーガーメニューボタン（紺色45px）を表示。タップするとサイドバーがスライドイン＋背景オーバーレイ表示。閉じるボタン（×）付き |
| 480px以下（小型スマートフォン） | サイドバー幅を260pxに縮小、メニューボタンを40pxに縮小 |

#### デザイントークン（CSS変数）

現在の実装で定義されている共通デザイン変数：

| 変数名 | 値 | 用途 |
|--------|-----|------|
| `--color-primary` | `#2b5b9e` | ボタン・リンクのメインカラー |
| `--color-primary-dark` | `#1e4278` | ホバー時の暗めブルー |
| `--color-accent` | `#1ddb1d` | チェックイン等のグリーン |
| `--color-error` | `#d32f2f` | エラー表示の赤 |
| `--color-text-primary` | `#444` | 本文テキスト色 |
| `--color-text-secondary` | `#666` | サブテキスト・ヘルプテキスト |
| `--color-border` | `#ddd` | ボーダー色 |
| `--font-family-base` | `'Noto Sans JP', sans-serif` | 全体のフォント |
| `--border-radius-sm` | `5px` | 入力フィールド等の角丸 |
| `--border-radius-md` | `20px` | カード等の角丸 |
| `--border-radius-lg` | `30px` | ボタン等の角丸 |
| `--shadow-default` | `0px 4px 8px rgba(0,0,0,0.2)` | 標準のドロップシャドウ |

### 6.2 ダッシュボード（ホーム画面）

#### 生徒用ホーム画面
| エリア | 表示内容 |
|--------|---------|
| 今日のスケジュール | 当日予定の問題リスト（「解く」ボタン付き） |
| 連続学習日数 | 「🔥 5日連続学習中！」のような表示 |
| 学習目標の進捗 | 週間目標に対するプログレスバー |
| 最近の学習履歴 | 直近5件の解答履歴 |
| お知らせ | 新着3件のお知らせ |

#### 施設職員（見守り者）用ホーム画面
| エリア | 表示内容 |
|--------|----------|
| 担当児童の学習サマリー | 今週の学習時間・正答率 |
| IEP進捗概要 | 担当児童のIEP目標に対する進捗状況 |
| 最新レポート | 直近の週間レポートへのリンク |
| お知らせ | 新着3件のお知らせ |

#### 学習支援員用ホーム画面
| エリア | 表示内容 |
|--------|----------|
| 担当児童一覧 | 児童ごとの進捗ステータス |
| 今日のスケジュール | 担当児童の当日予定 |
| 未完了アラート | 予定日を過ぎた未完了タスク |
| お知らせ | 新着3件のお知らせ |

#### 管理者用ホーム画面
| エリア | 表示内容 |
|--------|---------|
| システム統計 | 総ユーザー数・総問題数・本日のアクティブユーザー数 |
| 最近の活動 | 直近のシステムイベント |
| お知らせ | 新着3件のお知らせ |

### 6.3 デザインガイドライン

| 要素 | 指針 |
|------|------|
| プライマリーカラー | 青系統（学習・信頼を連想） |
| セカンダリーカラー | オレンジ系統（アクセント） |
| 正解・完了 | 緑系統 |
| 警告（期限近い等） | 黄色系統 |
| 不正解・エラー | 赤系統 |
| レスポンシブ対応 | PC・タブレット・スマートフォンすべてに対応 |
| フォント | 日本語の可読性を重視 |

---

## 7. データ管理

### 7.1 データベース構成概要

本システムでは以下の13種類のデータテーブルを使用します。詳細な定義は `Database.md` を参照してください。

| テーブル名 | 用途 | 主な関連 |
|-----------|------|---------|
| User | 全ユーザーの統合管理 | 全テーブルから参照 |
| Guardian_Student | 施設職員（見守り者）と児童の関係 | User × User |
| Staff_Student | 学習支援員と児童の担当関係 | User × User |
| Subject | 科目マスター（数学・国語等） | Problem_Category |
| Problem_Category | 問題の単元カテゴリ | Subject → Problem |
| Problem | 問題データ本体（出題形式を含む） | Problem_Category |
| Choice | 選択式問題の選択肢 | Problem |
| Status | スケジュールステータス（未着手・進行中・完了） | Schedule |
| Schedule | 学習スケジュール | User × Problem × Status |
| History | 学習履歴 | User × Problem |
| Information | お知らせ | User（作成者） |
| Question | アンケート質問マスター | Questionnaire |
| Questionnaire | アンケート回答 | User × Question |

### 7.2 データの保護

| 対策 | 内容 |
|------|------|
| パスワード保護 | ハッシュ化して保存（平文では保存しない） |
| アクセス制御 | ユーザー種別・担当関係に基づく閲覧制限 |
| 不正アクセス防止 | CSRF対策・SQLインジェクション対策・XSS対策を標準で実装 |
| 論理削除 | データは物理削除せず、無効化フラグで管理 |

---

## 8. 技術構成

### 8.1 技術スタック

| 項目 | 技術 |
|------|------|
| プログラミング言語 | Python 3.11+ |
| Webフレームワーク | Django 5.2 |
| データベース | SQLite（開発環境）/ PostgreSQL（本番環境想定） |
| フロントエンド | Django Templates + HTML + CSS + JavaScript |
| バージョン管理 | Git（Git Flow ブランチ戦略） |

### 8.2 アプリケーション構成

システムは以下の6つのモジュール（Djangoアプリ）で構成されています。

| モジュール | 役割 | 主要な画面 |
|-----------|------|-----------|
| accounts | ユーザー認証・アカウント管理 | ログイン、登録、ユーザー管理 |
| problems | 問題データの管理 | 問題一覧、問題作成、CSVインポート |
| schedules | 学習スケジュール管理 | カレンダー、スケジュール一覧、問題解答 |
| histories | 学習履歴・分析 | 履歴一覧、統計、グラフ、苦手分析 |
| announcements | お知らせ配信 | お知らせ一覧、作成・編集 |
| questionnaires | アンケート | 回答画面、集計結果 |

### 8.3 画面遷移（URL設計）

| 画面 | URL | 説明 |
|------|-----|------|
| ウェルカムページ | `/accounts/welcome/` | サービス入口 |
| ログイン | `/accounts/login/` | 認証画面 |
| 生徒ホーム | `/accounts/student_home/` | 生徒用ダッシュボード |
| 施設職員ホーム | `/accounts/guardian_home/` | 施設職員（見守り者）用ダッシュボード |
| 学習支援員ホーム | `/accounts/staff_home/` | 学習支援員用ダッシュボード |
| 管理者ホーム | `/accounts/admin_home/` | 管理者用ダッシュボード |
| 問題一覧 | `/problems/` | 問題のフィルタリング・閲覧 |
| 問題詳細 | `/problems/<id>/` | 個別の問題表示 |
| 問題作成 | `/problems/create/` | 新規問題の登録 |
| スケジュール一覧 | `/schedules/` | スケジュールの管理 |
| カレンダー | `/schedules/calendar/` | 月別カレンダー表示 |
| 今日のスケジュール | `/schedules/today/` | 当日の予定 |
| 問題を解く | `/schedules/<id>/solve/` | スケジュールから問題を解く |
| 履歴一覧 | `/histories/` | 学習履歴の閲覧 |
| 統計ダッシュボード | `/histories/stats/` | 正答率・学習時間等の統計 |
| 苦手分野 | `/histories/weak-points/` | 苦手分野の分析 |
| 復習推奨 | `/histories/review/` | 復習が必要な問題の一覧 |
| お知らせ一覧 | `/announcements/` | お知らせの閲覧 |

---

## 9. 開発ルール

### 9.1 コーディング規約
- **PEP 8** に準拠したPythonコードを書く
- 関数やクラスには**日本語のDocstring**を付ける
- 変数名・関数名は**意味が分かる英語**を使用する

### 9.2 Gitブランチ運用

| ブランチ | 用途 |
|---------|------|
| `main` | 本番環境用。リリース済みのコード |
| `develop` | 開発環境用。各機能の結合テスト |
| `feature/*` | 機能開発用（例：`feature/csv-import`） |
| `hotfix/*` | 緊急バグ修正用 |

- コミットメッセージの書き方は `GIT_COMMIT_MESSAGE.md` を参照

### 9.3 テスト方針
- 各機能に対して**ユニットテスト**を作成
- 主要な業務フロー（問題解答→履歴記録 等）は**統合テスト**を作成
- **テストカバレッジ 80%以上**を目標とする

---

## 10. 開発ロードマップ

### Phase 1: MVP（最小限の動作するプロダクト）
> 目標：基本的な学習フローを完成させる

| 優先度 | 対象 | 内容 |
|:------:|------|------|
| 1 | アカウント管理 | ユーザー認証（ログイン・ログアウト・登録）、full_nameの追加、user_type値の統一（administrator） |
| 2 | アカウント管理 | GuardianStudent（施設職員-児童）・StaffStudent（学習支援員-児童）モデルの実装、関係管理画面 |
| 3 | 問題管理 | Subject・ProblemCategory・Problemモデルの実装、問題一覧・詳細・CRUD画面 |
| 4 | スケジュール管理 | Schedule・Statusモデルの実装、スケジュール作成・一覧・「問題を解く」機能 |
| 5 | 学習履歴 | Historyモデルの実装、問題解答時の自動記録、履歴一覧 |

### Phase 2: 拡張機能
> 目標：分析・可視化機能と運用支援ツールを追加

| 優先度 | 対象 | 内容 |
|:------:|------|------|
| 1 | スケジュール | カレンダー表示（月別・週別）、一括スケジュール登録 |
| 2 | 学習履歴 | 統計ダッシュボード、グラフ表示、苦手分野分析 |
| 3 | 問題管理 | CSV一括インポート、検索・フィルタリング強化 |
| 4 | お知らせ | お知らせ機能の実装 |
| 5 | 学習目標 | 週間・月間目標の設定と進捗表示 |

### Phase 3: 高度な機能
> 目標：ユーザー体験の向上と自動化

| 優先度 | 対象 | 内容 |
|:------:|------|------|
| 1 | 学習履歴 | 復習推奨の自動提案、復習サイクルの完成 |
| 2 | ゲーミフィケーション | 達成バッジ、連続学習記録、目標達成通知 |
| 3 | 施設職員向けレポート | 週間レポート自動生成、IEP進捗レポート |
| 4 | アンケート | アンケート機能の実装 |
| 5 | 出題形式拡張 | 画像対応 |
| 6 | IEP連動 | 個別支援計画（IEP）目標登録・問題カテゴリ紐付け・進捗表示 |

### 将来構想
- REST API の提供（モバイルアプリ対応）
- PDF形式の学習レポート出力
- メール・プッシュ通知による学習リマインダー
- 気持ち・体調記録機能（子どもの心身状態の把握）
- ふりがな表示・アクセシビリティ強化
- ヒント・段階的ヒント機能（つまずき時の支援）
- スタッフ間の申し送り機能（シフト交代時の情報共有）
- メール通知による施設職員への定期レポート配信

---

## 11. 非機能要件

| 項目 | 要件 |
|------|------|
| ページ表示速度 | 3秒以内 |
| 同時接続ユーザー数 | 100人（初期） |
| 問題データ容量 | 10,000問まで対応 |
| 稼働率 | 99%以上 |
| バックアップ | 日次バックアップ |
| 対応ブラウザ | Chrome、Safari、Edge（最新版） |
| 対応デバイス | PC、タブレット、スマートフォン |

---

## 12. 用語集

| 用語 | 読み | 説明 |
|------|------|------|
| LMS | エルエムエス | Learning Management System（学習管理システム） |
| スケジュール | - | いつ・どの問題を解くかの予定 |
| 履歴（History） | - | 問題を解いた記録（時間・正誤・理解度を含む） |
| 理解度（Level） | - | 生徒が自己評価する理解の度合い。1（全く分からない）〜 5（完全に理解）の5段階 |
| ステータス（Status） | - | スケジュールの進行状態。未着手 → 進行中 → 完了 |
| 難易度（Difficulty） | - | 問題の難しさ。1（易）〜 5（難）の5段階 |
| カテゴリ | - | 問題の分類単位（例：一次方程式、分数の計算） |
| 科目（Subject） | - | 教科の単位（例：数学、国語、英語） |
| バッジ | - | 学習の達成条件をクリアした際に獲得できる称号・記章 |
| CSV | シーエスブイ | Comma Separated Values。問題データの一括登録に使用するファイル形式 |
| リッカート尺度 | - | アンケートの回答方式。1〜5段階で評価する方法 |
| IEP | アイイーピー | Individual Education Plan（個別支援計画）。児童ごとの学習目標・支援方針を定めた計画 |
| 児童養護施設 | じどうようごしせつ | 保護者のいない児童や虐待等により家庭での養育が困難な児童を養護する施設 |
| MVP | エムブイピー | Minimum Viable Product。最小限の機能で動くプロダクト |

---

## 13. 参考資料

| 資料名 | 説明 |
|--------|------|
| `Database.md` | データベースの詳細テーブル定義 |
| `GIT_COMMIT_MESSAGE.md` | Gitコミットメッセージの規約 |
| `問題作成/問題作成仕様書.md` | CSV問題データの作成仕様 |
| Django公式ドキュメント | https://docs.djangoproject.com/ |

---

## 改訂履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026/01/07 | 1.0 | 初版作成（技術仕様書として） |
| 2026/02/22 | 2.0 | サービス仕様書へ全面改訂。対象学年を小学生〜高校生に拡大。ゲーミフィケーション・学習目標・保護者レポート・CSV一括インポート機能を追加。user_type統一・full_name追加・出題形式明確化・Django 5.2対応を反映 |
| 2026/02/22 | 2.1 | 児童養護施設向けに全面改訂。「保護者」を「施設職員（見守り者）」に変更、「スタッフ」を「学習支援員」に変更。学年平均比較機能を削除。個別支援計画（IEP）連動機能を追加。将来構想に気持ち・体調記録等を追記 |
